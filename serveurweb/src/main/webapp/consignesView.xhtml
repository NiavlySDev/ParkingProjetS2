<?xml version = "1.0" encoding = "UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:p="http://primefaces.org/ui"
      xmlns:ui="jakarta.faces.facelets"
      xmlns:f="jakarta.faces.core">

    <h:head>
        <title>Consignes - Gestion de la Temperature des Locaux</title>
        <link rel="stylesheet" type="text/css" href="#{request.contextPath}/resources/style.css" />
        <script type="text/javascript">
            function toggleDarkMode() {
                document.body.classList.toggle('dark-mode');
                if(document.body.classList.contains('dark-mode')) {
                    localStorage.setItem('darkMode', '1');
                } else {
                    localStorage.removeItem('darkMode');
                }
            }
            window.onload = function() {
                if(localStorage.getItem('darkMode') === '1') {
                    document.body.classList.add('dark-mode');
                }
            }
        </script>
    </h:head>
    <h:body>
        <button onclick="toggleDarkMode()" style="position:fixed; top:20px; right:24px; z-index:1000; border-radius:18px; padding:8px 18px; background:#ececec; border:none; color:#222; font-weight:600; cursor:pointer;">
            üåô/‚òÄÔ∏è Mode
        </button>
        <h:panelGroup layout="block">
            <ui:include src="/templates/header.xhtml" />
        </h:panelGroup>
        <p:dataTable var="consigne" value="#{consignesBean.consignes}" styleClass="modern-table" style="margin-top:24px;">
            <p:column headerText="Identifiant Unique">
                <h:outputText value="#{consigne.id}" />
            </p:column>
            <p:column headerText="Local">
                <h:outputText value="#{consigne.local.numero}" />
            </p:column>
            <p:column headerText="Consigne">
                <h:outputText value="#{consigne.value}" />
            </p:column>
            <p:column headerText="Date">
                <h:outputText value="#{consigne.date}" />
            </p:column>
        </p:dataTable>

        <h:panelGroup rendered="#{loginBean.admin}" class="actions-bar">
            <p:commandButton value="Ajouter" type="button" icon="pi pi-plus"
                styleClass="rounded-button ui-button-success"
                onclick="PF('ajout_consigne').show()" rendered="#{loginBean.admin}"/>
            <p:commandButton value="Supprimer" type="button" icon="pi pi-times"
                styleClass="rounded-button ui-button-danger"
                onclick="PF('suppr_consigne').show()" rendered="#{loginBean.admin}"/>
        </h:panelGroup>

        <p:dialog header="Ajout Consigne" widgetVar="ajout_consigne" minHeight="40" width="400" showEffect="fade">
            <h4>Date: </h4>
            <p:calendar value="#{ajoutConsigneBean.date}" >
                <p:ajax event="dateSelect"/>
            </p:calendar>
            <h4>Heure: </h4>
            Heure: <p:inputNumber value="#{ajoutConsigneBean.heure}" minValue="0" maxValue="23"></p:inputNumber>
            Minute: <p:inputNumber value="#{ajoutConsigneBean.minute}" minValue="0" maxValue="59"></p:inputNumber>
            Seconde: <p:inputNumber value="#{ajoutConsigneBean.seconde}" minValue="0" maxValue="59"></p:inputNumber>
            <h4>Temp√©rature Consigne: </h4>
            <p:inputNumber value="#{ajoutConsigneBean.temp}"/>
            <h4>Salle: </h4>
            <div class="field col-12 md:col-4">
                <p:outputLabel for="@next" value=""/>
                <p:selectOneMenu value="#{ajoutConsigneBean.salle}">
                    <f:selectItems value="#{localSelectBean.sallesGroupes}"/>
                </p:selectOneMenu>
            </div>
            <f:facet name="footer">
                <p:commandButton value="Ajouter Consigne"
                                 icon="pi pi-plus"
                                 styleClass="rounded-button ui-button-success"
                                 action="#{ajoutConsigneBean.ajout()}"
                                 update="index:fragmentPanel messageindex message index:tabMenu user"/>
            </f:facet>
        </p:dialog>

        <p:dialog header="Supprimer Consigne" widgetVar="suppr_consigne" minHeight="40" width="400" showEffect="fade">
            <h4>Identifiant Unique: </h4>
            <p:inputNumber value="#{deleteConsigneBean.id}" minValue="0"></p:inputNumber>
            <f:facet name="footer">
                <p:commandButton value="Supprimer Consigne"
                                 icon="pi pi-times"
                                 styleClass="rounded-button ui-button-danger"
                                 action="#{deleteConsigneBean.delete()}"
                                 update="index:fragmentPanel messageindex message index:tabMenu user"/>
            </f:facet>
        </p:dialog>
    </h:body>
</html>