<?xml version = "1.0" encoding = "UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:p="http://primefaces.org/ui"
      xmlns:f="jakarta.faces.core">

    <h:head>
        <title>Gestion des Utilisateurs - Administration</title>
        <link rel="stylesheet" type="text/css" href="#{request.contextPath}/resources/style.css" />

        <script type="text/javascript">
            function toggleDarkMode() {
                document.body.classList.toggle('dark-mode');
                if(document.body.classList.contains('dark-mode')) {
                    localStorage.setItem('darkMode', '1');
                } else {
                    localStorage.removeItem('darkMode');
                }
            }
            window.onload = function() {
                if(localStorage.getItem('darkMode') === '1') {
                    document.body.classList.add('dark-mode');
                }
            }
        </script>
    </h:head>
    <h:body>
        <button onclick="toggleDarkMode()" style="position:fixed; top:20px; right:24px; z-index:1000; border-radius:18px; padding:8px 18px; background:#ececec; border:none; color:#222; font-weight:600; cursor:pointer;">
            üåô/‚òÄÔ∏è Mode
        </button>
        <br/>
        <h4>Gestion de Utilisateurs</h4>
        <p:dataTable id="user" var="user" value="#{usersBean.users}" style="margin-bottom:24px;">
            <p:column headerText="ID">
                <h:outputText value="#{user.id}" />
            </p:column>

            <p:column headerText="Pr√©nom">
                <h:outputText value="#{user.firstName}" />
            </p:column>

            <p:column headerText="Nom">
                <h:outputText value="#{user.name}" />
            </p:column>

            <p:column headerText="Age">
                <h:outputText value="#{user.age}" />
            </p:column>

            <p:column headerText="Login">
                <h:outputText value="#{user.login}" />
            </p:column>

            <p:column headerText="Genre">
                <h:outputText value="#{user.isMasculin ? 'Masculin' : 'F√©minin'}" />
            </p:column>

            <p:column headerText="Type de Compte">
                <h:outputText value="#{usersBean.isAdmin(user) ? 'Administrateur' : 'Agent'}" />
            </p:column>
        </p:dataTable>

        <h1>Actions:</h1>
        <p:commandButton value="Cr√©er Utilisateur" type="button" icon="pi pi-user-plus"
                         styleClass="rounded-button ui-button-success"
                         onclick="PF('creation').show()"/>&nbsp;&nbsp;

        <p:dialog header="Cr√©ation Utilisateur" widgetVar="creation" minHeight="40" width="350" showEffect="fade">
            <h4>Pr√©nom :</h4>
            <p:inputText value="#{ajouterUtilisateurBean.prenom}"/><br/>
            <h4>Nom :</h4>
            <p:inputText value="#{ajouterUtilisateurBean.nom}"/><br/>
            <h4>Age :</h4>
            <p:inputNumber value="#{ajouterUtilisateurBean.age}" minValue="18" decimalPlaces="0" />
            <h4>Masculin ?</h4>
            <p:toggleSwitch value="#{ajouterUtilisateurBean.masculin}" onIcon="pi pi-check" offIcon="pi pi-times" />
            <h4>Administrateur ?</h4>
            <p:toggleSwitch value="#{ajouterUtilisateurBean.admin}" onIcon="pi pi-check" offIcon="pi pi-times" />
            <f:facet name="footer">
                <p:commandButton value="Cr√©er Utilisateur"
                                 styleClass="rounded-button ui-button-warning"
                                 action="#{ajouterUtilisateurBean.ajouter()}"
                                 update="index:fragmentPanel messageindex message index:tabMenu user"/>
            </f:facet>
        </p:dialog>

        <p:commandButton value="Modifier Utilisateur" type="button" icon="pi pi-user-edit"
                         styleClass="rounded-button ui-button-help"
                         onclick="PF('modification').show()"/>&nbsp;&nbsp;

        <p:dialog id="modificationDialog" header="Modification Utilisateur" widgetVar="modification" minHeight="40" width="350" showEffect="fade">
            <h4>Utilisateur :</h4>
            <p:selectOneMenu value="#{modifierUtilisateurBean.id}">
                <f:selectItems value="#{utilisateurSelectBean.usersGroupes}" />
                <p:ajax event="change" listener="#{modifierUtilisateurBean.findUtilisateur}" update="modificationDialog" />
            </p:selectOneMenu>
            <br/><br/>
            <h4>Pr√©nom :</h4>
            <p:inputText value="#{modifierUtilisateurBean.prenom}" disabled="#{!modifierUtilisateurBean.utilisateurTrouve}"/><br/>
            <h4>Nom :</h4>
            <p:inputText value="#{modifierUtilisateurBean.nom}" disabled="#{!modifierUtilisateurBean.utilisateurTrouve}"/><br/>
            <h4>Age :</h4>
            <p:inputNumber value="#{modifierUtilisateurBean.age}" minValue="18" decimalPlaces="0"  disabled="#{!modifierUtilisateurBean.utilisateurTrouve}"/>
            <h4>Masculin ?</h4>
            <p:toggleSwitch value="#{modifierUtilisateurBean.masculin}" onIcon="pi pi-check" offIcon="pi pi-times" disabled="#{!modifierUtilisateurBean.utilisateurTrouve}"/>
            <h4>Administrateur ?</h4>
            <p:toggleSwitch value="#{modifierUtilisateurBean.admin}" onIcon="pi pi-check" offIcon="pi pi-times" disabled="#{!modifierUtilisateurBean.utilisateurTrouve}"/>
            <br/><br/>
            <p:commandButton value="Modifier Utilisateur"
                             styleClass="rounded-button ui-button-warning"
                             action="#{modifierUtilisateurBean.modifier()}"
                             update="index:fragmentPanel messageindex message index:tabMenu user"
                             disabled="#{!modifierUtilisateurBean.utilisateurTrouve}"/>
        </p:dialog>

        <p:commandButton value="Suppression Utilisateur" type="button" icon="pi pi-user-minus"
                         styleClass="rounded-button ui-button-danger"
                         onclick="PF('suppression').show()"/>

        <p:dialog header="Suppression d'utilisateur" widgetVar="suppression" minHeight="40" width="350" showEffect="fade">
            <h4>Utilisateur :</h4>
            <p:selectOneMenu value="#{supprimerUtilisateurBean.id}" onchange="#{supprimerUtilisateurBean.findUtilsiateur()}">
                <f:selectItems value="#{utilisateurSelectBean.usersGroupes}"/>
            </p:selectOneMenu>
            <f:facet name="footer">
                <p:commandButton value="Supprimer Utilisateur"
                                 styleClass="rounded-button ui-button-warning"
                                 action="#{supprimerUtilisateurBean.supprimer()}"
                                 update="index:fragmentPanel messageindex message index:tabMenu user"/>
            </f:facet>
        </p:dialog>
    </h:body>
</html>